<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECHO AI - Neural Interface</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-glow: #00d4ff;
            --secondary-glow: #ff00ff;
            --accent-glow: #00ff88;
            --neural-purple: #7c3aed;
            --deep-space: #0a0118;
            --card-bg: rgba(15, 23, 42, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, system-ui, sans-serif;
            background: var(--deep-space);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: radial-gradient(circle at 20% 50%, var(--primary-glow) 0%, transparent 50%),
                        radial-gradient(circle at 80% 50%, var(--secondary-glow) 0%, transparent 50%),
                        radial-gradient(circle at 50% 80%, var(--accent-glow) 0%, transparent 50%);
            animation: nebula 20s ease-in-out infinite;
            opacity: 0.1;
            z-index: -2;
        }
        
        @keyframes nebula {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
        }
        
        /* Grid pattern overlay */
        body::after {
            content: '';
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            opacity: 0.3;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* Futuristic header */
        .header {
            text-align: center;
            margin-bottom: 50px;
            position: relative;
        }
        
        .logo {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow), var(--accent-glow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -2px;
            animation: glow-pulse 3s ease-in-out infinite;
        }
        
        @keyframes glow-pulse {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }
        
        .tagline {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        /* Neural network decoration */
        .neural-decoration {
            position: absolute;
            width: 100%;
            height: 200px;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            pointer-events: none;
            opacity: 0.2;
        }
        
        /* Glass card design */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            padding: 30px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-glow), transparent);
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .card:hover {
            border-color: rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 212, 255, 0.1);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-glow), var(--neural-purple));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Grid layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* Form styling */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.3s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-glow);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
            background: rgba(15, 23, 42, 0.9);
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }
        
        /* Futuristic buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-glow), var(--neural-purple));
            color: white;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Response display */
        .response-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            position: relative;
        }
        
        .response-box::before {
            content: 'AI RESPONSE';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--deep-space);
            padding: 0 10px;
            font-size: 0.75rem;
            color: var(--primary-glow);
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        /* Status indicators */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 30px;
        }
        
        .status-card {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .status-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-glow), var(--accent-glow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .status-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 5px;
        }
        
        /* Conversation interface */
        .conversation-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
            height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .conversation-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            animation: message-appear 0.3s ease;
        }
        
        @keyframes message-appear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--neural-purple), var(--secondary-glow));
            color: white;
        }
        
        .message.assistant {
            align-self: flex-start;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        /* Input area */
        .input-area {
            display: flex;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .input-area input {
            flex: 1;
        }
        
        /* Learning feedback */
        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-feedback {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid transparent;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .btn-approve {
            border-color: rgba(16, 185, 129, 0.5);
        }
        
        .btn-approve:hover {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgb(16, 185, 129);
        }
        
        .btn-edit {
            border-color: rgba(245, 158, 11, 0.5);
        }
        
        .btn-edit:hover {
            background: rgba(245, 158, 11, 0.2);
            border-color: rgb(245, 158, 11);
        }
        
        .btn-reject {
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .btn-reject:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgb(239, 68, 68);
        }
        
        /* Loading animation */
        .loading {
            display: inline-flex;
            gap: 5px;
        }
        
        .loading span {
            width: 8px;
            height: 8px;
            background: var(--primary-glow);
            border-radius: 50%;
            animation: pulse 1.4s ease-in-out infinite;
        }
        
        .loading span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .loading span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes pulse {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--primary-glow), var(--neural-purple));
            border-radius: 10px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .logo {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="neural-decoration">
                <svg width="100%" height="100%" viewBox="0 0 1200 200">
                    <defs>
                        <linearGradient id="neural-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:0" />
                            <stop offset="50%" style="stop-color:#00d4ff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#00d4ff;stop-opacity:0" />
                        </linearGradient>
                    </defs>
                    <path d="M0,100 Q300,50 600,100 T1200,100" stroke="url(#neural-gradient)" stroke-width="2" fill="none" opacity="0.5">
                        <animate attributeName="d" 
                            values="M0,100 Q300,50 600,100 T1200,100;
                                    M0,100 Q300,150 600,100 T1200,100;
                                    M0,100 Q300,50 600,100 T1200,100"
                            dur="4s" repeatCount="indefinite" />
                    </path>
                </svg>
            </div>
            <h1 class="logo">ECHO AI</h1>
            <p class="tagline">Neural Response System • Learning Interface</p>
        </div>
        
        <!-- Main Grid -->
        <div class="grid">
            <!-- Message Processing -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">📡</div>
                    <h2 class="card-title">Message Processing</h2>
                </div>
                
                <form id="messageForm">
                    <div class="form-group">
                        <label>Platform</label>
                        <select id="platform">
                            <option value="email">📧 Email</option>
                            <option value="sms">📱 SMS</option>
                            <option value="slack">💬 Slack</option>
                            <option value="discord">🎮 Discord</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Sender</label>
                        <input type="text" id="sender" placeholder="john@example.com" value="colleague@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Message</label>
                        <textarea id="messageContent" placeholder="Enter your message...">Can we schedule a meeting next week to discuss the Q4 project timeline?</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Urgency Level</label>
                        <input type="range" id="urgency" min="0" max="1" step="0.1" value="0.5" 
                               oninput="document.getElementById('urgencyValue').textContent = this.value">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="font-size: 0.8rem; color: var(--text-secondary);">Low</span>
                            <span id="urgencyValue" style="font-size: 0.8rem; color: var(--primary-glow);">0.5</span>
                            <span style="font-size: 0.8rem; color: var(--text-secondary);">High</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Process Message
                    </button>
                </form>
                
                <div id="messageResponse" class="response-box" style="display: none;">
                    <div id="messageResult"></div>
                </div>
            </div>
            
            <!-- AI Analysis -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">🧠</div>
                    <h2 class="card-title">AI Analysis Engine</h2>
                </div>
                
                <form id="llmForm">
                    <div class="form-group">
                        <label>Input Message</label>
                        <textarea id="llmMessage" placeholder="Message for AI analysis...">I need help preparing for tomorrow's presentation. Can you review my slides?</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Response Profile</label>
                        <select id="responseStyle">
                            <option value="professional">🎯 Professional</option>
                            <option value="casual">😊 Casual</option>
                            <option value="technical">💻 Technical</option>
                            <option value="friendly">🤝 Friendly</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Generate AI Response
                    </button>
                </form>
                
                <div id="llmResponse" class="response-box" style="display: none;">
                    <div id="llmResult"></div>
                </div>
            </div>
        </div>
        
        <!-- Conversation Interface -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">💬</div>
                <h2 class="card-title">Neural Conversation Interface</h2>
            </div>
            
            <div class="conversation-container">
                <div id="conversation" class="conversation-messages"></div>
                
                <div class="input-area">
                    <input type="text" id="quickMessage" placeholder="Type your message..." 
                           onkeypress="if(event.key==='Enter') sendQuickMessage()">
                    <button class="btn btn-primary" onclick="sendQuickMessage()">Send</button>
                </div>
            </div>
            
            <div class="status-grid">
                <div class="status-card">
                    <div class="status-value" id="messageCount">0</div>
                    <div class="status-label">Messages</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="avgResponseTime">0ms</div>
                    <div class="status-label">Response Time</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="llmStatus">🔴</div>
                    <div class="status-label">AI Status</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="learningScore">0%</div>
                    <div class="status-label">Learning Score</div>
                </div>
            </div>
        </div>
        
        <!-- Learning System -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">🔮</div>
                <h2 class="card-title">Adaptive Learning System</h2>
            </div>
            
            <div id="lastResponse" style="display: none;">
                <h3 style="margin-bottom: 15px; color: var(--text-secondary);">Last AI Response</h3>
                <div class="response-box">
                    <p id="responseContent" style="margin-bottom: 15px;"></p>
                    
                    <div class="feedback-buttons">
                        <button class="btn btn-feedback btn-approve" onclick="submitFeedback('approved')">
                            ✅ Approve
                        </button>
                        <button class="btn btn-feedback btn-edit" onclick="showEditArea()">
                            ✏️ Edit
                        </button>
                        <button class="btn btn-feedback btn-reject" onclick="submitFeedback('rejected')">
                            ❌ Reject
                        </button>
                    </div>
                    
                    <div id="editArea" style="display: none; margin-top: 15px;">
                        <textarea id="editedResponse" placeholder="Edit the response..." 
                                  style="width: 100%; min-height: 100px; margin-bottom: 10px;"></textarea>
                        <button class="btn btn-primary" onclick="submitEditedResponse()">Submit Edit</button>
                    </div>
                </div>
            </div>
            
            <div class="response-box" style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px; color: var(--primary-glow);">Learning Insights</h3>
                <div id="insights">
                    <p style="color: var(--text-secondary);">No insights yet. Start interacting to see learning patterns!</p>
                </div>
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-primary" onclick="fetchLearningTrends()">
                    📊 View Learning Analytics
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        let messageCount = 0;
        let totalResponseTime = 0;
        let learningScore = 0;
        
        // Check LLM status on load
        async function checkLLMStatus() {
            try {
                const response = await fetch(`${API_BASE}/messages/test-llm`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: "test",
                        platform: "test",
                        sender: "test"
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('llmStatus').textContent = data.llm_available ? '🟢' : '🔴';
                }
            } catch (error) {
                document.getElementById('llmStatus').textContent = '🔴';
            }
        }
        
        // Message processing form
        document.getElementById('messageForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const button = e.target.querySelector('button');
            button.disabled = true;
            button.innerHTML = '<div class="loading"><span></span><span></span><span></span></div> Processing...';
            
            const responseDiv = document.getElementById('messageResponse');
            const resultDiv = document.getElementById('messageResult');
            
            try {
                const response = await fetch(`${API_BASE}/messages/process`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: document.getElementById('messageContent').value,
                        platform: document.getElementById('platform').value,
                        sender: document.getElementById('sender').value,
                        urgency: parseFloat(document.getElementById('urgency').value)
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <span style="color: var(--text-secondary);">Action:</span>
                            <span style="color: var(--primary-glow); font-weight: 600;">${data.action_taken}</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <span style="color: var(--text-secondary);">Confidence:</span>
                            <span style="color: var(--accent-glow); font-weight: 600;">${(data.confidence * 100).toFixed(1)}%</span>
                        </div>
                        <div style="color: var(--text-secondary); margin-bottom: 10px;">Generated Response:</div>
                        <div style="background: rgba(0, 212, 255, 0.05); padding: 15px; border-radius: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">
                            ${data.suggested_response || 'No response generated'}
                        </div>
                    `;
                    responseDiv.style.display = 'block';
                    
                    // Store for learning
                    if (data.suggested_response) {
                        window.currentMessageId = data.id;
                        window.currentResponse = data.suggested_response;
                        showResponseForFeedback(data.suggested_response);
                    }
                } else {
                    throw new Error(data.detail || 'Failed to process message');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: #ef4444;">Error: ${error.message}</div>`;
                responseDiv.style.display = 'block';
            } finally {
                button.disabled = false;
                button.innerHTML = 'Process Message';
            }
        });
        
        // LLM testing form
        document.getElementById('llmForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const button = e.target.querySelector('button');
            button.disabled = true;
            button.innerHTML = '<div class="loading"><span></span><span></span><span></span></div> Generating...';
            
            const responseDiv = document.getElementById('llmResponse');
            const resultDiv = document.getElementById('llmResult');
            
            const startTime = Date.now();
            
            try {
                const response = await fetch(`${API_BASE}/messages/test-llm`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: document.getElementById('llmMessage').value,
                        platform: 'test',
                        sender: 'user@example.com',
                        recipient: 'me'
                    })
                });
                
                const data = await response.json();
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <span style="color: var(--text-secondary);">Response Time:</span>
                            <span style="color: var(--primary-glow); font-weight: 600;">${responseTime}ms</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="color: var(--text-secondary); margin-bottom: 10px;">AI Analysis:</div>
                            <pre style="background: rgba(0, 0, 0, 0.5); padding: 15px; border-radius: 10px; overflow-x: auto; font-size: 0.875rem;">
${JSON.stringify(data.analysis, null, 2)}</pre>
                        </div>
                        <div>
                            <div style="color: var(--text-secondary); margin-bottom: 10px;">Generated Response:</div>
                            <div style="background: rgba(0, 212, 255, 0.05); padding: 15px; border-radius: 10px; border: 1px solid rgba(0, 212, 255, 0.2);">
                                ${data.enhanced_response || data.basic_response || 'No response generated'}
                            </div>
                        </div>
                    `;
                    responseDiv.style.display = 'block';
                } else {
                    throw new Error(data.detail || 'Failed to generate response');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: #ef4444;">Error: ${error.message}</div>`;
                responseDiv.style.display = 'block';
            } finally {
                button.disabled = false;
                button.innerHTML = 'Generate AI Response';
            }
        });
        
        // Quick message sender
        async function sendQuickMessage() {
            const input = document.getElementById('quickMessage');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to conversation
            addToConversation('user', message);
            input.value = '';
            
            // Show typing indicator
            const typingId = Date.now();
            addTypingIndicator(typingId);
            
            const startTime = Date.now();
            
            try {
                const response = await fetch(`${API_BASE}/messages/test-llm`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: message,
                        platform: 'chat',
                        sender: 'user@example.com'
                    })
                });
                
                const data = await response.json();
                const responseTime = Date.now() - startTime;
                
                // Remove typing indicator
                removeTypingIndicator(typingId);
                
                // Update stats
                messageCount++;
                totalResponseTime += responseTime;
                document.getElementById('messageCount').textContent = messageCount;
                document.getElementById('avgResponseTime').textContent = 
                    Math.round(totalResponseTime / messageCount) + 'ms';
                
                if (response.ok) {
                    const reply = data.enhanced_response || data.basic_response || 
                                 'I understand your message. How can I help you?';
                    addToConversation('assistant', reply);
                    
                    // Update learning score
                    learningScore = Math.min(100, learningScore + 2);
                    document.getElementById('learningScore').textContent = learningScore + '%';
                } else {
                    addToConversation('assistant', 'Sorry, I encountered an error processing your message.');
                }
            } catch (error) {
                removeTypingIndicator(typingId);
                addToConversation('assistant', 'Connection error. Please try again.');
            }
        }
        
        function addToConversation(role, content) {
            const conversation = document.getElementById('conversation');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const time = new Date().toLocaleTimeString();
            messageDiv.innerHTML = `
                <div>${content}</div>
                <div class="message-time">${time}</div>
            `;
            
            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }
        
        function addTypingIndicator(id) {
            const conversation = document.getElementById('conversation');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.id = `typing-${id}`;
            typingDiv.innerHTML = '<div class="loading"><span></span><span></span><span></span></div>';
            conversation.appendChild(typingDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }
        
        function removeTypingIndicator(id) {
            const typingDiv = document.getElementById(`typing-${id}`);
            if (typingDiv) typingDiv.remove();
        }
        
        // Learning system functions
        let currentMessageId = null;
        let currentResponse = null;
        
        function showResponseForFeedback(response) {
            document.getElementById('responseContent').textContent = response;
            document.getElementById('lastResponse').style.display = 'block';
            document.getElementById('editedResponse').value = response;
        }
        
        async function submitFeedback(feedbackType) {
            if (!currentMessageId || !currentResponse) return;
            
            try {
                const response = await fetch(`${API_BASE}/learning/feedback`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message_id: currentMessageId,
                        feedback_type: feedbackType,
                        original_response: currentResponse,
                        context: {
                            platform: document.getElementById('platform').value,
                            sender: document.getElementById('sender').value
                        }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateInsights(data.insights);
                    showFeedbackSuccess(feedbackType);
                    
                    // Update learning score
                    learningScore = Math.min(100, learningScore + 5);
                    document.getElementById('learningScore').textContent = learningScore + '%';
                }
            } catch (error) {
                console.error('Error submitting feedback:', error);
            }
        }
        
        function showEditArea() {
            document.getElementById('editArea').style.display = 'block';
        }
        
        async function submitEditedResponse() {
            if (!currentMessageId || !currentResponse) return;
            
            const editedResponse = document.getElementById('editedResponse').value;
            
            try {
                const response = await fetch(`${API_BASE}/learning/feedback`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message_id: currentMessageId,
                        feedback_type: 'edited',
                        original_response: currentResponse,
                        edited_response: editedResponse,
                        context: {
                            platform: document.getElementById('platform').value,
                            sender: document.getElementById('sender').value
                        }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateInsights(data.insights);
                    showFeedbackSuccess('edited');
                    document.getElementById('editArea').style.display = 'none';
                    
                    // Update learning score
                    learningScore = Math.min(100, learningScore + 10);
                    document.getElementById('learningScore').textContent = learningScore + '%';
                }
            } catch (error) {
                console.error('Error submitting edited response:', error);
            }
        }
        
        function updateInsights(insights) {
            if (!insights || insights.length === 0) return;
            
            const insightsDiv = document.getElementById('insights');
            insightsDiv.innerHTML = insights.map(insight => `
                <div style="padding: 10px; background: rgba(0, 212, 255, 0.05); border-radius: 8px; margin-bottom: 10px;">
                    <strong style="color: var(--primary-glow);">${insight.type}:</strong> 
                    <span>${insight.message}</span>
                    <span style="color: var(--text-secondary); font-size: 0.8rem; display: block; margin-top: 5px;">
                        Confidence: ${(insight.confidence * 100).toFixed(0)}%
                    </span>
                </div>
            `).join('');
        }
        
        function showFeedbackSuccess(type) {
            const feedbackButtons = document.querySelector('.feedback-buttons');
            const originalHTML = feedbackButtons.innerHTML;
            
            const messages = {
                approved: '✅ Response approved!',
                rejected: '❌ Response rejected!',
                edited: '✏️ Response updated!'
            };
            
            feedbackButtons.innerHTML = `<div style="color: var(--accent-glow); text-align: center; width: 100%; font-weight: 600;">${messages[type]}</div>`;
            
            setTimeout(() => {
                feedbackButtons.innerHTML = originalHTML;
                document.getElementById('lastResponse').style.display = 'none';
            }, 2000);
        }
        
        async function fetchLearningTrends() {
            try {
                const response = await fetch(`${API_BASE}/learning/trends?days=7`);
                if (response.ok) {
                    const data = await response.json();
                    displayTrends(data.trends);
                }
            } catch (error) {
                console.error('Error fetching trends:', error);
            }
        }
        
        function displayTrends(trends) {
            const insightsDiv = document.getElementById('insights');
            insightsDiv.innerHTML = `
                <h4 style="color: var(--primary-glow); margin-bottom: 15px;">7-Day Learning Analytics</h4>
                <div style="display: grid; gap: 15px;">
                    <div style="background: rgba(0, 212, 255, 0.05); padding: 15px; border-radius: 10px;">
                        <strong>Approval Rate:</strong> 
                        <span style="color: var(--accent-glow); font-size: 1.5rem; font-weight: 700;">
                            ${(trends.approval_rate_trend?.[trends.approval_rate_trend.length - 1]?.approval_rate * 100 || 0).toFixed(1)}%
                        </span>
                    </div>
                    <div style="background: rgba(0, 212, 255, 0.05); padding: 15px; border-radius: 10px;">
                        <strong>Key Improvements:</strong>
                        <ul style="margin: 10px 0 0 20px; color: var(--text-secondary);">
                            ${(trends.improvement_areas || []).map(area => `<li>${area}</li>`).join('')}
                        </ul>
                    </div>
                    <div style="background: rgba(0, 212, 255, 0.05); padding: 15px; border-radius: 10px;">
                        <strong>Satisfaction Trend:</strong> 
                        <span style="color: var(--accent-glow);">
                            ${trends.user_satisfaction_trend?.[trends.user_satisfaction_trend.length - 1]?.satisfaction 
                                ? '📈 Improving' : '📊 Stable'}
                        </span>
                    </div>
                </div>
            `;
        }
        
        // Initialize
        checkLLMStatus();
        
        // Periodically check LLM status
        setInterval(checkLLMStatus, 30000);
        
        // Add welcome message
        setTimeout(() => {
            addToConversation('assistant', 'Welcome to ECHO AI! I\'m here to help you with any questions or tasks. How can I assist you today?');
        }, 1000);
    </script>
</body>
</html>